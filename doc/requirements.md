# 4x4 Pixel Diary 要件定義書

## 概要

4x4ピクセルアートを描いて他のユーザーと交換する日記アプリケーション。

## 機能要件

### FR-001: キャンバス描画

- 4x4（16ピクセル）のグリッドキャンバスを表示する
- 各ピクセルはクリックで現在選択中の色に塗り替えられる
- 初期状態は全ピクセル白色（#ffffff）

### FR-002: 色選択

- ネイティブカラーピッカー（`<input type="color">`）で任意の色を選択可能
- 選択中の色をプレビュー表示
- デフォルト色: #ffb7b2（ピンク）

### FR-003: タイトル入力

- 絵のタイトルを入力可能
- 最大5文字制限
- 未入力時は「むだい」をデフォルトとする

### FR-004: 絵の交換

- 「こうかんする」ボタンで絵を投稿
- 投稿時、他のユーザーの未交換の絵とランダムに交換
- 交換相手がいない場合、自分の絵は交換待ちキューに保管
- 交換成功時: 「あなたの元に新しい絵がやってきました」
- 交換待ち時: 「投稿ありがとう！交換相手がいなかったので...」

#### バリデーション

- キャンバスが全て白色 かつ タイトル未入力の場合は投稿不可
- エラーメッセージ: 「キャンバスが真っ白で、タイトルもありません」

### FR-005: アルバム表示

- 交換で受け取った絵をアルバムとして一覧表示
- ローカルストレージに永続化
- 新しい絵が先頭に表示（降順）

### FR-006: 絵の詳細モーダル

- アルバムアイテムをクリックで拡大表示
- タイトルと日付（MM/DD形式）を表示
- モーダル外クリックまたは×ボタンで閉じる

### FR-007: 絵の削除

- 各アルバムアイテムに×ボタンを表示
- 確認ダイアログ: 「この絵をアルバムから削除しますか？」
- 承認後、ローカルストレージからも削除

## 非機能要件

### NFR-001: UI/UX

- 日本語UI
- ピクセルアート風デザイン
- フォント: DotGothic16（Google Fonts）
- レスポンシブ対応（モバイルファースト）
- image-rendering: pixelated でピクセルアートの鮮明表示

### NFR-002: パフォーマンス

- First Contentful Paint (FCP): 1.5秒以内
- Largest Contentful Paint (LCP): 2.5秒以内
- フォントの遅延読み込み対応

### NFR-003: セキュリティ

- Supabase認証情報はサーバーサイドで管理
- RLSポリシーでデータアクセス制御
- 入力値のバリデーション（サーバーサイド）

### NFR-004: ブラウザ対応

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## ユーザーフロー

```
┌─────────────────────────────────────────────────────────────────┐
│                        アプリ起動                               │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│  ローカルストレージからアルバムデータを読み込み                  │
│  → アルバムセクションに表示                                      │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     キャンバス描画                               │
│  1. 色を選択（カラーピッカー）                                   │
│  2. ピクセルをクリックして塗る                                   │
│  3. タイトルを入力（任意、5文字まで）                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                   「こうかんする」クリック                       │
└─────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┴───────────────┐
              ▼                               ▼
┌─────────────────────────┐     ┌─────────────────────────┐
│  バリデーションエラー    │     │  バリデーション成功      │
│  (全白 & タイトル空)     │     │                         │
│  → アラート表示          │     │                         │
└─────────────────────────┘     └─────────────────────────┘
                                              │
                                              ▼
                              ┌─────────────────────────────┐
                              │   Supabase RPC 呼び出し      │
                              │   exchange_art()             │
                              └─────────────────────────────┘
                                              │
                      ┌───────────────────────┴───────────────────────┐
                      ▼                                               ▼
        ┌─────────────────────────┐                 ┌─────────────────────────┐
        │  交換成功                │                 │  交換待ち                │
        │  (他者の絵を取得)        │                 │  (キューに絵なし)        │
        │  → アルバムに追加        │                 │  → 保管メッセージ表示    │
        │  → 成功メッセージ表示    │                 │                         │
        └─────────────────────────┘                 └─────────────────────────┘
                      │                                               │
                      └───────────────────────┬───────────────────────┘
                                              ▼
                              ┌─────────────────────────────┐
                              │     キャンバスリセット       │
                              │     (全ピクセル白、タイトル空)│
                              └─────────────────────────────┘
```

## デザイン仕様

### カラーパレット

| 変数名 | 値 | 用途 |
|--------|-----|------|
| --border-color | #222 | メインボーダー |
| --inactive-border | #d4d4d4 | 非アクティブボーダー |
| --bg-color | #fffbf0 | 背景色 |
| --container-bg | #ffffff | コンテナ背景 |
| アクセント | #ffb7b2 | ボタン、ハイライト |

### レイアウト

- メインコンテナ幅: 300px
- キャンバスサイズ: 200px × 200px（4×4グリッド）
- アルバムセクション最大幅: 600px
- ミニグリッドサイズ: 80px × 80px
- モーダルグリッドサイズ: 240px × 240px
